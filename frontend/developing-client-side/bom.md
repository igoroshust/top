## Введение в BOM-элементы и их взаимодействие
Browser Object Model (BOM) предоставляет объекты для взаимодействия с браузером и его окружением. Основные элементы: `window` (глобальный объект), `navigator` (информация о браузере), `location` (URL и навигация), `history` (история просмотров), `screen` (экран устройства), `geolocation` (геолокация), `localStorage/sessionStorage` (хранение данных). Они позволяют управлять окнами, получать данные о пользователе, навигировать и хранить информацию.


### Взаимодействие с `window` (глобальный объект браузера)
`window` - корень BOM, представляет окно браузера. Через него доступны другие объекты (например, `window.document` для DOM)

**Пример-1. Открытие нового окна и управление им**
```javascript
// window.open() создаёт новое окно (BOM)
const newWindow = window.open('https://composite.website/', '_blank', 'width=400,height=300');

// Через 2 секунды закрываем его
setTimeout(() => {
    newWindow.close();
}, 2000);

// Выводим размеры текущего окна
console.log('Ширина: ', window.innerWidth, 'Высота: ', window.innerHeight);
```

**Пример-2. Обработка событий окна**
```javascript
// Событие при изменении размера окна
window.addEventListener('resize', function(){
    console.log('Высота:', window.innerHeight, 'Ширина:', window.innerWidth);
});

// Событие перед закрытием страницы
window.addEventListener('beforeunload', function(e){
    e.returnValue = 'Вы уверены, что хотите уйти?'; // Браузер не покажет это сообщение пользователю, текст изменить нельзя.
});
``` 

### Взаимодействие с `navigator` (информация о браузере и устройстве)
`navigator` предоставляет данные о браузере, ОС, поддержке функций.

**Пример-1. Проверка поддержки геолокации и получения данных**
```javascript
if (navigator.getolocation) {
    navigator.geolocation.getCurrentPosition(
        (position) => {
            console.log('Широта:', position.coords.latitude, 'Долгота:', position.coords.longitude);
        },
        (error) => {
            console.error('Ошибка геолокации:', error.message);
        }
    );
} else {
    console.log('Геолокация не поддерживается');
}

// Вывод информации о браузере
console.log('Браузер: ', navigator.userAgent, 'Язык:', navigator.language);
```

**Объяснение**: `navigator.geolocation` – API для геолокации (требует разрешения пользователя). Взаимодействие: проверка поддержки и получение данных о местоположении + метаданные браузера.


**Пример-2. Проверка онлайн-статуса**
```javascript
console.log('Онлайн:', navigator.onLine);

// События изменения статуса
window.addEventListener('online', alert('Соединение восстановлено'));
window.addEventListener('offline', alert('Соединение потеряно'));
```
**Объяснение**: `navigator.onLine` – проверяет интернет-соединение. События BOM реагируют на изменения. Взаимодействие: мониторинг сети.


### Взаимодействие с `location` (URL и навигация)
`location` - управляет текущим URL и позволяет перенаправлять.

**Пример-1. Изменение URL и перезагрузка**
```javascript
// Вывод текущего URL
console.log('Текущий URL:', location.href);

// Изменение адреса (без перезагрузки)
location.pathname = '/new-page';

// Обновление страницы
setInterval(() => {
    // location.reload();
}, 10000);
```
**Объяснение**: `location.href` – полный URL. Изменение свойств (как `pathname`) обновляет адрес. `reload()` перезагружает страницу. Взаимодействие: Навигация без BOM-методов вроде `history`.

**Пример-2. Разбор URL и перенаправление**
```javascript
console.log(`Протокол: ${location.protocol}
Хост: ${location.host}
Путь: ${location.pathname}`);
```
**Объяснение**: Свойства `location` разбирают URL. Присвоение `href` перенаправляет. Взаимодействие: Анализ и изменение навигации.


### Взаимодействие с `history` (история просмотров)
`history` - управляет историей браузера.

**Пример-1. Навигация по истории**
```javascript
console.log('Длина истории:', history.length)

// Назад (аналог history.back())
history.go(-1); // на 1 шаг назад

// Вперёд
history.go(2); // на 2 шага вперёд
// history.forward(); // вперёд на 1 шаг (без аргументов)

```
**Объяснение**: `history.length` - количество страниц. `go(n)` перемещает на n шагов. Взаимодействие: управление навигацией без изменения URL напрямую.

**Пример-2. Добавление записи в историю (без перезагрузки)**
```javascript
// Добавляем новую "страницу" в историю
history.pushState({page: 'new'}, 'Новая страница', '/new-url');

// Обработка события изменения истории
window.addEventListener('popstate', (e) => {
    console.log('История изменилась:', e.state);
});
```
**Объяснение**: `pushState()` - добавляет запись в историю браузера без загрузки страницы (SPA). `popstate` - событие при навигации. Взаимодействие: манипуляция историей для одностраничных приложений.

Подробнее про `pushState()`:
```javascript
history.pushState(state, title, url);

// Адрес в браузере меняется на /new-url, страница не перезагружается, сохранённый объект state будет доступен при навигации назад/вперёд

// state ({page: 'new'}) - объект с данными, который сохраняется вместе с новой записью в истории. Может содержать любую информацию о состоянии приложения.

// title ('Новая страница') - заголовок страницы (игнорируется в большинстве браузров, но можно передать пустую строку)

// url ('/new-url') - новый URL, который отобразится в адресной строке (должен быть из того же домена).
```

Подробнее про `popstate`:
Событие срабатывает, когда пользователь:
- Нажимает кнопку "Назад" (back) в браузере;
- Нажимает кнопку "Вперёд" (forward) в браузере;
- Вызывает методы `history.back()`, `history.forward()`, `history.go()`.

Событие НЕ СРАБАТЫВАЕТ при вызове `pushState()` или `replaceState()`. Срабатывает только при навигации между записями истории (назад/вперёд). Обработчик события получает объект состояния `e`, содержащий полезную информацию.


**Пример (добавляем запись историю)**
1. Нужно добавить несколько страниц в историю
2. Перемещаться по кнопкам `back` и `forward`, чтобы увидеть результат в консоле
```html
<!DOCTYPE html>
<html>
<head>
    <title>Test popstate</title>
</head>
<body>
    <button onclick="addHistory()">Добавить в историю</button>
    <script>
        // Обработчик события
        window.addEventListener('popstate', (e) => {
            console.log('state:', e.state);
        });

        // Функция добавления новой страницы в историю
        function addHistory(){
            const state = { page: Date.now() }
            history.pushState(state, `Page ${state.page}`, `t=${state.page}`);
            console.log('В историю добавлена новая страница: ', state);
        }
    </script>
</body>
</html>
```